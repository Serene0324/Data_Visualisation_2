{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/Serene0324/Data_Visualisation_2/main/enrolment_school_district.csv"
  },
  "transform": [
    {"filter": "datum.sex == 'male' || datum.sex == 'female'"},
    {
      "aggregate": [
        {"op": "sum", "field": "students", "as": "total_students"}
      ],
      "groupby": ["state", "sex"]
    },
    {
      "calculate": "datum.sex == 'male' ? -datum.total_students : datum.total_students",
      "as": "students_signed"
    }
  ],
  "width": "container",
  "height": 350,
  "mark": {"type": "bar"},
  "encoding": {
    "y": {
      "field": "state",
      "type": "nominal",
      "sort": "-x",
      "title": "State"
    },
    "x": {
      "field": "students_signed",
      "type": "quantitative",
      "title": "Number of Students",
      "axis": {"format": "s"}
    },
    "color": {
      "field": "sex",
      "type": "nominal",
      "scale": {
        "domain": ["male", "female"],
        "range": ["#1800A3", "#A30000"]
      },
      "legend": {
        "title": "Sex",
        "titleFontSize": 10, 
        "labelFontSize": 9
      }
    },
    "tooltip": [
      {"field": "state", "type": "nominal", "title": "State"},
      {"field": "sex", "type": "nominal", "title": "Sex"},
      {
        "field": "total_students",
        "type": "quantitative",
        "title": "Total Students",
        "format": ","
      }
    ]
  },
  "config": {
    "view": {"stroke": "transparent"},
    "axis": {"labelFontSize": 13, "titleFontSize": 12}
  }
}
